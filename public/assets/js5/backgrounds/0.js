'use strict';BG.col={fg:'#FFF',acc:'#B96',bg:{hue:0,sat:0,val:0}};var scene={cellSize:16,padding:2,drawGrid:true,thinkInt:100,fadeSpeed:4,lastThink:0,oldCells:{},cells:{}};BG.init=function(canvas){this.onResize(canvas);var cw=Math.ceil(canvas.width/scene.cellSize);var ch=Math.ceil(canvas.height/scene.cellSize);for(var i=1;i<cw*ch/5;i++){scene.cells[Math.floor(Math.random()*cw*ch)]=true}};BG.onResize=function(canvas){canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight};BG.think=function(canvas,paused){if(!paused){if(Date.now()>scene.lastThink+scene.thinkInt){var w=canvas.width;var h=canvas.height;var cw=Math.ceil(w/scene.cellSize);var ch=Math.ceil(h/scene.cellSize);for(var i=0;i<cw*ch;i++){if(scene.cells[i])scene.oldCells[i]=1;else scene.oldCells[i]=Math.max((scene.oldCells[i]||0)-1/scene.thinkInt*scene.fadeSpeed,0)}for(var _i=0;_i<cw*ch;_i++){var cell=scene.oldCells[_i];var neighbors=[scene.oldCells[_i-cw-1],scene.oldCells[_i-cw],scene.oldCells[_i-cw+1],scene.oldCells[_i-1],scene.oldCells[_i+1],scene.oldCells[_i+cw-1],scene.oldCells[_i+cw],scene.oldCells[_i+cw+1]];var count=0;for(var j=0;j<8;j++){if(neighbors[j]==1)count++}if(cell==1){if(count<2||count>3)scene.cells[_i]=undefined;else scene.cells[_i]=true;}else if(count==3)scene.cells[_i]=true}scene.lastThink=Date.now()}}else return true};BG.draw=function(ctx){var w=ctx.canvas.width;var h=ctx.canvas.height;var cw=Math.ceil(w/scene.cellSize);var ch=Math.ceil(h/scene.cellSize);if(scene.drawGrid){ctx.fillStyle='#444';for(var i=1;i<cw;i++){ctx.fillRect(i*scene.cellSize,0,1,h)}for(var j=1;j<ch;j++){ctx.fillRect(0,j*scene.cellSize,w,1)}}for(var _i2=0;_i2<cw*ch;_i2++){if(scene.cells[_i2]||scene.oldCells[_i2]){var cx=_i2%cw;var cy=Math.floor(_i2/cw);if(scene.cells[_i2])ctx.fillStyle='#fff';else if(scene.oldCells[_i2])ctx.fillStyle='hsl(145, 50%, '+scene.oldCells[_i2]*40+'%)';ctx.fillRect(cx*scene.cellSize+scene.padding+1,cy*scene.cellSize+scene.padding+1,scene.cellSize-scene.padding*2-1,scene.cellSize-scene.padding*2-1)}}};var mDown=false;BG.onMouseDown=function(canvas,mx,my){mDown=true;this.onMouseMove(canvas,mx,my)};BG.onMouseUp=function(){mDown=false};BG.onMouseMove=function(canvas,mx,my){var cx=Math.floor(mx/scene.cellSize);var cy=Math.floor(my/scene.cellSize);var id=cy*Math.ceil(canvas.width/scene.cellSize)+cx;if(mDown)scene.cells[id]=true;else scene.oldCells[id]=Math.max(scene.oldCells[id],0.5)};