'use strict';BG.col={fg:'#FFF',acc:'#F00',bg:{hue:0,sat:0,val:20}};var scene={cellSize:2,thinkInt:1/25,drawAnt:true,direction:1,curPos:-1,lastThink:0,cells:{},newCells:{},states:[1,-1]};BG.init=function(canvas){this.onResize(canvas);var cw=Math.ceil(canvas.width/scene.cellSize);var ch=Math.ceil(canvas.height/scene.cellSize);var ctx=canvas.getContext('2d');ctx.translate(-(cw-canvas.width/scene.cellSize)/2,-(ch-canvas.height/scene.cellSize)/2);for(var i=2;i<Math.floor(Math.random()*8);i++){scene.states[i]=Math.floor(Math.random()*2)*2-1}scene.curPos=cw*ch/2;if(scene.curPos%cw==0)scene.curPos+=cw/2;scene.curPos=Math.floor(scene.curPos)};BG.onResize=function(canvas){canvas.width=Math.ceil(canvas.offsetWidth/6);canvas.height=Math.ceil(canvas.offsetHeight/6)};BG.think=function(canvas,paused){if(!paused){if(Date.now()>scene.lastThink+scene.thinkInt){var cw=Math.ceil(canvas.width/scene.cellSize);var ch=Math.ceil(canvas.height/scene.cellSize);for(var i=0;i<Math.ceil(1/scene.thinkInt);i++){var curState=scene.cells[scene.curPos]||0;scene.cells[scene.curPos]=++curState%scene.states.length;if(!scene.cells[scene.curPos])scene.cells[scene.curPos]=undefined;var nextCell=void 0;switch(scene.direction){case 0:nextCell=scene.curPos-cw;break;case 1:nextCell=scene.curPos+1;break;case 2:nextCell=scene.curPos+cw;break;case 3:nextCell=scene.curPos-1;break;}if(nextCell>cw*ch)nextCell=nextCell%(cw*ch);if(nextCell<0)nextCell=nextCell+cw*ch;scene.curPos=nextCell;scene.direction+=scene.states[scene.cells[nextCell]||0];if(scene.direction>3)scene.direction=0;else if(scene.direction<0)scene.direction=3}scene.lastThink=Date.now()}}};BG.draw=function(ctx){var w=ctx.canvas.width;var h=ctx.canvas.height;var cw=Math.ceil(w/scene.cellSize);var ch=Math.ceil(h/scene.cellSize);ctx.clearRect(0,0,w,h);for(var i=0;i<cw*ch;i++){var cell=scene.cells[i];if(cell){var cx=i%cw;var cy=Math.floor(i/cw);var hue=cell*(360/scene.states.length);ctx.fillStyle='hsl('+hue+', 60%, 60%)';ctx.fillRect(cx*scene.cellSize,cy*scene.cellSize,1,1);ctx.fillStyle='hsl('+hue+', 60%, 35%)';ctx.fillRect(cx*scene.cellSize,cy*scene.cellSize+1,1,1)}}if(scene.drawAnt){var antx=scene.curPos%cw;var anty=Math.floor(scene.curPos/cw);ctx.fillStyle=this.col.acc;ctx.fillRect(antx*scene.cellSize,anty*scene.cellSize,1,1)}};